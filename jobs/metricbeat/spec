---
name: metricbeat

templates:
  bin/ctl: bin/ctl
  bin/pre-start: bin/pre-start
  bin/ctl_utils.sh: bin/ctl_utils.sh
  config/metricbeat.yml: config/metricbeat.yml
  config/modules.d/kafka.yml.disabled: config/modules.d/kafka.yml.disabled
  config/modules.d/zookeeper.yml.disabled: config/modules.d/zookeeper.yml.disabled
  config/modules.d/redis.yml.disabled: config/modules.d/redis.yml.disabled
  config/modules.d/system.yml: config/modules.d/system.yml
  config/metricbeat_ilm_policy.json: config/metricbeat_ilm_policy.json

packages: 
- metricbeat

consumes:
- name: elasticsearch
  type: elasticsearch
  optional: true
- name: kibana
  type: kibana
  optional: true
- name: kafka
  type: kafka
  optional: true
- name: zookeeper
  type: zookeeper
  optional: true
- name: redis
  type: redis
  optional: true

properties:
  metricbeat.name:
    description: "Name to display in Infrastructure App in Kibana. By default this information is fetch from BOSH Context."
  metricbeat.elasticsearch.hosts:
    description: "Elastic Search master nodes host/ip to connect with"
    default: []
  metricbeat.elasticsearch.port:
    description: "Elastic Search master nodes port"
    default: 9200
  metricbeat.elasticsearch.protocol:
    description: "Elastic Search master nodes protocol (http or https)"
    default: http
  metricbeat.kibana.host:
    description: "Kibana node ip/host for setup dashboards"
  metricbeat.kibana.port:
    description: "Kibana node port"
    default: 5601
  metricbeat.kibana.protocol:
    description: "Kibana node protocol (http or https)"
    default: http
  metricbeat.modules.enabled:
    description: "List of modules you want to enable"
    default: []
  metricbeat.modules.kafka.hosts:
    description: "List of kafka brokers hosts"
  metricbeat.modules.kafka.port:
    description: "Kafka port"
    default: 9092
  metricbeat.modules.zookeeper.hosts:
    description: "Zookeeper host list"
  metricbeat.modules.zookeeper.port:
    description: "Zookeeper hosts port"
    default: 2181
  metricbeat.ilm.enabled:
    description: "Enables or disables index lifecycle management on any new indices created by Metricbeat. Valid values are true, false, and auto. When auto (the default) is specified on version 7.0 and later, Metricbeat automatically uses index lifecycle management if the feature is enabled in Elasticsearch and has the required license; otherwise, Metricbeat creates daily indices."
    default: auto
  metricbeat.ilm.rollover_alias:
    description: "The index lifecycle write alias name. The default is metricbeat-%{[agent.version]}. Setting this option changes the alias name."
    default: "metricbeat-%{[agent.version]}"
  metricbeat.ilm.pattern:
    description: "The rollover index pattern. The default is %{now/d}-000001."
    default: "%{now/d}-000001"
  metricbeat.ilm.policy_name:
    description: "The name to use for the lifecycle policy. The default is metricbeat-%{[agent.version]}."
    default: "metricbeat-%{[agent.version]}"
  metricbeat.ilm.check_exists:
    description: "When set to false, disables the check for an existing lifecycle policy. The default is true. You need to disable this check if the Metricbeat user connecting to a secured cluster doesnâ€™t have the read_ilm privilege."
    default: false
  metricbeat.ilm.overwrite:
    description: "When set to true, the lifecycle policy is overwritten at startup. The default is false."
    default: true
  metricbeat.ilm.policy:
    description: "a hash with the structure explained in https://www.elastic.co/guide/en/elasticsearch/reference/7.4/getting-started-index-lifecycle-management.html"
    default:
      policy: 
        phases: 
          hot: 
            min_age: 0ms
            actions: {}
          delete: 
            min_age: 7d
            actions: 
              delete: {}
